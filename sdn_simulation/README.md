# Simulate SINDIT network flow

## Environment
- Create and activate virtual env python 3.8. Ryu only support python 3.8

Example:
```bash
conda create -n rxoms python=3.8
conda activate rxoms
```

- Init environment variable `$RXOMS_PATH` to RXOMS root folder. `$RXOMS_PATH` is used to load some configurations, write logs, and save output.
```bash
$ export RXOMS_PATH="<...>/RXOMS/"
```

- Install mininet and its python SDK. Mininet will create a environment to simulate the network while the SDK will help developer to interact with the network.
```bash
$ pip install mininet
$ apt-get install mininet
```
- Install rxoms library: navigate to RXOMS root folder `<...>/RXOMS/`. The rxoms library provides some utilities to read/write configurations/logs/output, interact with the network, and build services for monitoring the network
```bash
$ pip install .
```
- Install ryu library. The ryu library provide a simple way to implement a network controller with some basic functions e.g., network flow monitoring and firewall.
```bash
$ pip install ryu
```



## Start Simple Ryu Controller
- Open a terminal and navigate to `<...>/RXOMS/sdn_simulation/controller` folder. The implementation of the controller is in `simpleController.py`. To use the initiated environment, active the environment first. Then, run the controller by calling `ryu-manager` with the controller implementation.

```bash
$ conda activate rxoms
$ ryu-manager simpleController.py
```

## Start Network Traffic Generation
*Note: Mininet must be run as root, this environment must be create as root*

- Open another terminal and navigate to `<...>/RXOMS/sdn_simulation/traffic_generator`
- Activate the initiated environment and run the script `start_traffic.sh` to start the network traffic generation. The script will create a network topology defined in `sindit_traffic.py`, including 6 factory components and 2 gateways (8 hosts) and 2 switches. The hosts will send the traffic to each other. The traffic is generated by the `iperf` tool. The network traffice is simulated based on data collected from SINDIT factory (`<...>/RXOMS/data/normalizedDT`).
```bash
$ conda activate rxoms
$ chmod +x start_traffic.sh 
$ start_traffic.sh
```

## Collect Network Flow Data

*Note: Messaging system (RabbitMQ) must be ready before running the simulation*

- After the network traffic is generated, the controller will collect the network flow data. The network flow data is reported via messaging system (currently using local RabbitMQ). For using other messaging system, the developer can change the configuration in `<...>/RXOMS/configuration/qoa`
- To collect the monitoring messages, open another terminal and navigate to `<...>/RXOMS/sdn_simulation/collector`.
```bash
$ conda activate rxoms
$ python3.8 -E collector.py
```
- The network flow data collected will be saved in file `<...>/RXOMS/data/sdn_simulation/raw_message.csv`.